{"componentChunkName":"component---src-templates-blog-post-js","path":"/make-interactive-story-map-leaflet-non-geographical-images/","result":{"data":{"site":{"siteMetadata":{"title":"jarednielsen.com"}},"markdownRemark":{"id":"ab9df0a8-4583-51e7-90e4-a851b2cbae5e","excerpt":"I recently discovered the Digital Collections archived and made public by the Library of Congress. The collections range from historical photographs and graphic…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMUlEQVR42hXN61PaBgAA8Pxx27d92O02u11bLCIW5JHwECKRVwBDSALhFR4JJBDCKyAiBJlGeYjautrNu52r2u6uLW23u/0Ru379ffkBf6nR3w7QWxW/n1J3p/FblbgZY7cqfjch/17Qx3VPv7R10UPfzhMPs/jtMf67ErmfUDeH+I0SBl4fYqR/NRVebxUcvTJcSYGpsI6nzYMqLGVB3LtqWvvOa39USphnXbSZt0c9TznS1BeQy34IuOgFi7Hn9SyYxfQ8bRWS1gJhqKYtBxU4G92QWee+4GFwQ5Hc3BfgaSfI05ZywtJh3ffTBDAQXJWkucM6O6xTLm4d1ndkzllNWxTJ82KEyWXXsYxO9kJt1jlu+oaih6M2q2molrX9eUIBamOHiW6U4qZGziazW0MRUeUAT5vqOfDtS6YvIoMaMm76egJ8oWCXQyxPGPkk2C66PlzlALW5w2AbLGVsFRxiBjrtoCMJaRTsjYLt1RGhdtHLw5jIQFzC1CjaFQmppMFy0ipm7e8uMsDVMEL4NF9bzjmoIicddF+AxSzYLW91eVc8pMuTm52yu5oBy0mLIiFE4Bnp15YS1nfnKeB6hGHIEykDKjWkkXeorUC76GjkbYMqrEgIlzBX0tAeD0uMrZq2DkWPQJt52srFLQ9nSeCojnCkQcqA7YKjztgPhG0xbWVJo1LdPmp6hZSVDGgF2lrLQqMaImXAVEgXD2gpv3bRQ4HTppf0aXKYvkRtiiloJCINBmJJYytv6/PudESfQHWZiF7KQJnIesyrYQlDPLAW9WjOukHgV3Hbb19hdvV0cC2PG/pldytnSwSfUT6NXHAUcEORMHKUiQ5o+YSJDmqbDOSzPULAn04kBOgV7bpfvoHNP2TCurD7MeZ5mttd90I/Pn/ybSG6sQs/9kIrlHcVdf4sxE0caeQIg9PwvRdaUXgX8OaYUOvIkei5Ogi/GmAXvfAfo+hc9o+r8GsFm8qBSSvwsh85bXrP99BrBbtWsLNOcNoOPkwo4NMM/+8F9e85uZzF/lnEP8/J5Tz2YRr9OI0u57H3U3x5Rn1ekF8WX305wz/NY+8n+Jtx5G4c+h+OIeoHFX+tYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Pictorial St. Louis\"\n        title=\"\"\n        src=\"/static/a897e28baa1bdbdf51765dbfaa2075c1/f058b/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images.png\"\n        srcset=\"/static/a897e28baa1bdbdf51765dbfaa2075c1/c26ae/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images.png 158w,\n/static/a897e28baa1bdbdf51765dbfaa2075c1/6bdcf/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images.png 315w,\n/static/a897e28baa1bdbdf51765dbfaa2075c1/f058b/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images.png 630w,\n/static/a897e28baa1bdbdf51765dbfaa2075c1/40601/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images.png 945w,\n/static/a897e28baa1bdbdf51765dbfaa2075c1/78612/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images.png 1260w,\n/static/a897e28baa1bdbdf51765dbfaa2075c1/29007/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images.png 1600w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>I recently discovered the <a href=\"https://www.loc.gov/collections/\">Digital Collections</a> archived and made public by the Library of Congress. The collections range from historical photographs and graphic arts to newspaper clippings and maps. I wanted to do something fun with one of these collections and learn some new technology at the same time. The <a href=\"https://www.loc.gov/resource/g4164sm.gpm00001/?sp=1\">Pictorial St. Louis collection</a> caught my eye.</p>\n<p>What I found most interesting about this collection was the scope, the aerial perspective, and the detail of the drawing. I wanted to see all of the drawings stitched together in one large map. So I downloaded all 110 images, cropped and cleaned up the edges, then spliced them together in one massive file: 64000 x 20275 pixels. I could have gone slightly larger, but that was the limit of what the GPU on my laptop could handle. I need the file as large as possible so I would lose very little of the resolution for zooming in on details.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.645569620253163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHklEQVR42k3PS4rCQBSF4ex/AaUhjypTr5vk1tVEyiI+0JkgbkBQEB0EXIKDRGjppr/hPzhwovV67Zyz1kopsyxTSmW/kiTRWgNAWZZaa8aYtZZzniRJlmVxHEdKKSKqqmq5XHZdt1qtjDEAQEQA8O1EZIwhIuec9/6vR1JKImrbFhGFEMYY7z0iGmOqHwDAObfWfieEEHmeN02z3++jtm0BwDnXdd1ms9ntdofDYT6fI+L3SxzHk8lEa42IeZ4rpS6XyziO7/c7StOUMcY5XywWTdPMZrO6rsuyRMQ0TYUQUsrpdMoYK4rieDyez+fX6zWO4zAMUd/31+v1dDqFEOq6LooihLDdbkMI3vvb7fZ8Ph+Px/1+7/t+GIbxnw8ey/1grgwIMQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The compiled map image\"\n        title=\"\"\n        src=\"/static/cd7fff8ec8d5edb2377e517f8808a290/f058b/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images-compiled.png\"\n        srcset=\"/static/cd7fff8ec8d5edb2377e517f8808a290/c26ae/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images-compiled.png 158w,\n/static/cd7fff8ec8d5edb2377e517f8808a290/6bdcf/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images-compiled.png 315w,\n/static/cd7fff8ec8d5edb2377e517f8808a290/f058b/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images-compiled.png 630w,\n/static/cd7fff8ec8d5edb2377e517f8808a290/40601/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images-compiled.png 945w,\n/static/cd7fff8ec8d5edb2377e517f8808a290/78612/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images-compiled.png 1260w,\n/static/cd7fff8ec8d5edb2377e517f8808a290/29007/jarednielsen-make-interactive-story-map-leaflet-non-geographical-images-compiled.png 1600w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>I initially thought I would make a standalone app and I’ve done image processing in the past with Processing and openFrameworks, so I mocked up some tests in both of those, but neither was the right tool. Even a 5000 x 3500 px image was more than Processing could, well, process. And openFrameworks was the long-way to make something very simple. I wanted the drawing(s) to function like a map, with zoom and pan and no loss of resolution.</p>\n<p>So I Googled it: ‘How do Google maps work?’</p>\n<p>The answer? JavaScript and nested directories of image tiles.</p>\n<p>Through a bit more Google Fu, I found <a href=\"http://leafletjs.com/\">Leaflet.js</a>, “an open-source JavaScript library for mobile-friendly interactive maps”.</p>\n<ul>\n<li>\n<p>See for yourself! <a href=\"http://jarednielsen.com/pictorial-st-louis/index.html\">Pictorial St. Louis</a>.</p>\n</li>\n<li>\n<p>Download the source code! <a href=\"https://github.com/nielsenjared/pictorial-st-louis\">nielsenjared/pictorial-st-louis</a></p>\n</li>\n</ul>\n<h2>Non-Geographical Image Maps with Leaflet.js</h2>\n<p>Leaflet is refreshingly easy to use and lightweight. Take a look at <a href=\"https://github.com/nielsenjared/pictorial-st-louis/blob/master/index.html\"><code class=\"language-text\">index.html</code> in my GitHub repository</a>.</p>\n<p>The magic here is happening in the referenced JavaScript files, which are a bit more complicated because I’m using a non-geographical raster image rather than a pre-existing map. I found <a href=\"https://commenthol.github.io/leaflet-rastercoords/\">leaflet-rastercoords</a>, a project that simplifies using raster images as map tiles. (see also: <a href=\"https://github.com/commenthol/leaflet-rastercoords\">Github repo</a>).</p>\n<p>“What’s the big deal with using non-geographical raster images as maps?”, you ask.</p>\n<p>For a map to be useful, interactive and interesting, it needs to be big and feature zoom functionality. This is relatively easy to do with vector graphics, which are not really image files, but a set of instructions for how to draw shapes and lines, or with pre-existing tile libraries, like MapBox. Raster images, on the other hand, are bitmaps, which means every pixel of the image is assigned a value. So raster image files are generally much larger than vector image files because they contain more information. As I’m sure you are well aware, big images on a site take time to load, especially on a mobile device.</p>\n<h2>Story Mapping with Leaflet.js</h2>\n<p>While I was searching GitHub for ideas and examples of Leaflet projects, I found <a href=\"https://github.com/jackdougherty/leaflet-storymap\">Jack Dougherty’s excellent storymap repo</a> (If you want to learn more, check out his free book, Data Viz For All.) This was the perfect way to easily make Pictorial St Louis interactive, and most important, interesting, so I hacked leaflet-rastercoords together with leaflet-storymap.</p>\n<p>Next I needed a story to tell. My first step was to Tweet at <a href=\"https://twitter.com/LOCMaps\">LCMaps</a> and <a href=\"https://twitter.com/STLMapRoom\">STLMapRoom</a>…</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">Hey <a href=\"https://twitter.com/STLMapRoom?ref_src=twsrc%5Etfw\">@STLMapRoom</a> I made a map using Dry&#39;s 1875 drawings from <a href=\"https://twitter.com/LOCMaps?ref_src=twsrc%5Etfw\">@LOCMaps</a> Can anyone help me with context/background? <a href=\"https://t.co/uMfmLZwYZV\">https://t.co/uMfmLZwYZV</a></p>&mdash; Jared Nielsen (@jarednielsen) <a href=\"https://twitter.com/jarednielsen/status/862307223334268929?ref_src=twsrc%5Etfw\">May 10, 2017</a></blockquote>\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>The LCMaps account referred me to the <a href=\"https://www.loc.gov/rr/askalib/\">Ask a Librarian</a> service provided by the Library of Congress. I submitted a question and three days later received a response with attached pdfs scanned from books providing history and context for both panoramic maps and the artist of Pictorial St. Louis, Camille N. Dry.</p>\n<p>Then I spent a few days researching Dry and late 19th Century St. Louis. I found some excellent resources:</p>\n<ul>\n<li><a href=\"http://lucasandgarrison.com/homepage/introduction/the-maps/\">Lucas and Garrison 1875</a></li>\n<li><a href=\"http://www.historyhappenshere.org/node/7694\">History Happens Here — The Missour History Museum’s Blog</a></li>\n<li><a href=\"https://www.distilledhistory.com/\">Distilled History</a></li>\n<li><a href=\"https://www.stlouis-mo.gov/archive/neighborhood-histories-norbury-wayman/bissell/works4.htm\">City of St. Louis Archive</a></li>\n<li><a href=\"https://www.flickr.com/photos/73762611@N00/5992654457\">Keen Delage via Flickr</a></li>\n</ul>\n<p>It was then simply a matter of ‘writing’ a story and filling in the blanks in maps.geojson.</p>\n<h2>DIY: Make an Interactive Story Map Using Leaflet.js and Non-Geographical Images</h2>\n<p>Making your own story map with Leaflet.js and non-geographical images is super easy. The instructions below assume your are using a Unix-based command line.</p>\n<p>Download or clone this repo: <a href=\"https://github.com/nielsenjared/pictorial-st-louis\">https://github.com/nielsenjared/pictorial-st-louis</a></p>\n<h3>ImageMagick</h3>\n<p>This approach is a bit ridiculous and convoluted, but it’s my quick-and-dirty workaround for the Github file size limit of 100MB (The full .png is ~900MB). You need to stitch together the complete map from the slices included in the maps directory and then slice that file into tiles.</p>\n<p>I know.</p>\n<p>If you don’t have it already, install ImageMagick:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> imagemagick</code></pre></div>\n<p>Change into the maps directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd maps</code></pre></div>\n<p>And run</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">convert <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">(</span> 01.png 02.png 03.png 04.png 05.png 06.png 07.png 08.png +append <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">\\</span>\n <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">(</span> 09.png <span class=\"token number\">10</span>.png <span class=\"token number\">11</span>.png <span class=\"token number\">12</span>.png <span class=\"token number\">13</span>.png <span class=\"token number\">14</span>.png <span class=\"token number\">15</span>.png <span class=\"token number\">16</span>.png +append <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">\\</span>\n <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">(</span> <span class=\"token number\">17</span>.png <span class=\"token number\">18</span>.png <span class=\"token number\">19</span>.png <span class=\"token number\">20</span>.png <span class=\"token number\">21</span>.png <span class=\"token number\">22</span>.png <span class=\"token number\">23</span>.png <span class=\"token number\">24</span>.png +append <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">\\</span>\n <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">(</span> <span class=\"token number\">25</span>.png <span class=\"token number\">26</span>.png <span class=\"token number\">27</span>.png <span class=\"token number\">28</span>.png <span class=\"token number\">29</span>.png <span class=\"token number\">30</span>.png <span class=\"token number\">31</span>.png <span class=\"token number\">32</span>.png +append <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">(</span> <span class=\"token number\">33</span>.png <span class=\"token number\">34</span>.png <span class=\"token number\">35</span>.png <span class=\"token number\">36</span>.png <span class=\"token number\">37</span>.png <span class=\"token number\">38</span>.png <span class=\"token number\">39</span>.png <span class=\"token number\">40</span>.png +append <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">\\</span>\n <span class=\"token parameter variable\">-append</span> <span class=\"token punctuation\">..</span>/map.png</code></pre></div>\n<p>This will generate map.png in the parent directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd ..</code></pre></div>\n<p>In case you’re interested, I spliced the original with this snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">convert key.png -crop 8000x4055 %04d.png</code></pre></div>\n<h3>Making Tiles</h3>\n<p>I used a Python script to create my raster tiles. <a href=\"https://github.com/commenthol/gdal2tiles-leaflet\">https://github.com/commenthol/gdal2tiles-leaflet</a></p>\n<p>First, you will need to install GDAL:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt-get python-gdal</code></pre></div>\n<p>Next, download or clone gdal2tiles.py:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone https://github.com/commenthol/gdal2tiles-leaflet.git</code></pre></div>\n<p>The README explains how to determine optimal zoom level:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">echo “l(x/256)/l(2)” | bc -l</code></pre></div>\n<p>Where ‘x’ is the width of the image you want to tile.</p>\n<p>So in my case</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">echo “l(64000/256)/l(2)” | bc -l</code></pre></div>\n<p>Returned</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">7.96578428466208704368</code></pre></div>\n<p>Round up. Mine is 8.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd gdal2*</code></pre></div>\n<p>Next run</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">python gdal2tiles.py -l -p raster -z 0–8 -w none ../map.png ../tiles</code></pre></div>\n<p>This will generate a series of nested directories populated with image tiles in a new directory, ‘tiles’.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd ..</code></pre></div>\n<p>That’s it! Open index.html in a browser.</p>\n<ul>\n<li>\n<p>See for yourself! <a href=\"http://jarednielsen.com/pictorial-st-louis/index.html\">Pictorial St. Louis</a>.</p>\n</li>\n<li>\n<p>Download the source code! <a href=\"https://github.com/nielsenjared/pictorial-st-louis\">nielsenjared/pictorial-st-louis</a></p>\n</li>\n</ul>","frontmatter":{"title":"How to Make an Interactive Story Map Using Leaflet.js and Non-Geographical Images","date":"May 22, 2017","description":"It's easier than you think to make an interactive story map with Leaflet.js and non-geographical images. This tutorial walks you through how I did it using the Pictorial St. Louis collection from the Library of Congress."}},"previous":null,"next":{"fields":{"slug":"/deploy-gatsbyjs-github-pages-user/"},"frontmatter":{"title":"How to Deploy a GatsbyJS Blog on GitHub Pages as a User Site"}}},"pageContext":{"id":"ab9df0a8-4583-51e7-90e4-a851b2cbae5e","previousPostId":null,"nextPostId":"0ff9cfbe-3238-5b30-abcd-c86920a5378a"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}